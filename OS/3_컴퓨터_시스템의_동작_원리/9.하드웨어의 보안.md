# 💻 하드웨어의 보안

우리가 흔히 사용하는 운영체제는 여러 프로그램이 동시에 실행될 수 있는 다중 프로그래밍 환경에서 동작한다. 그러므로 각 프로그램이 다른 프로그램의 실행을 방해하거나 프로그램 근에 충돌을 일으키는 문제를 막기 위해 하드웨어에 대한 각종 보안 기법이 필요하다.

> 하드웨어적인 보안을 유지하기 위해서 운영체제는 기본적으로 **커널 모드(Kernel mode)** 와 **사용자 모드**의 두 가지 모드를 지원한다.

가령 어떤 프로그램이 이상한 명령을 수행시켜 다른 프로그램의 메모리 영역이나 파일 영역을 침범하는 경우가 발생할 수 있다.

따라서 중요한 정보에 접근해 위험한 상황을 초래할 수 있는 연산은 커널 모드에서만 실행되도록 하여 일반 사용자 프로그램이 직접 위험한 명령을 수행할 수 없도록 하고, 그렇지 않은 일반적인 연산만 사용자 모드에서 사용자 프로그램이 수행하도록 통제하여 보안성을 확보하게 된다.

커널 모드는 운영체제가 CPU의 제어권을 가지고 운영체제 코드를 실행하는 모드로서, 이 모드에서는 모든 종류의 명령을 전부 수행할 수 있다.

반면 사용자 모드에서는 일반 사용자 프로그램이 실행되며 제한적인 명령만 수행할 수 있다.

그러나 중요한 연산을 운영체제만이 수행할 수 있도록 정의하더라도 사용자 프로그램이 프로그램 내에서 그런 종류의 연산을 수행해버리면 제어가 아무런 소용이 없게 된다.

> 사용자 프로그램이 CPU를 가지고 있는 동안에는 운영체제가 자신의 코드를 실행하지 못하므로 사용자 프로그램을 감시할 방법이 없기 때문이다.

그러므로 이러한 상황을 방지하기 위해서는 하드웨어적인 자원이 필요하다.

컴퓨터 시스템은 CPU 내에 모드비트(mode bit)를 두어 사용자 프로그램을 감시하게 된다.

- 모드비트 0 : 커널 모드로서 모든 명령 수행 가능
- 모드비트 1 : 사용자 모드로서 제한된 명령만을 수행 가능

CPU는 보안과 관련된 명령을 수행하기 전에는 항상 모드비트를 조사해 그 값이 0으로 세팅된 경우에만 수행하게 된다. 그리고 운영체제가 CPU를 점유해 자신의 코드를 수행하다가 사용자 프로그램에게 CPU의 제어권을 넘길 때 모드비트를 1로 세팅한 후 넘기게 된다.

사용자 프로그램이 수행되다가 하드웨어 접근 등 보안이 필요한 중요한 명령을 수행해야 할 경우 시스템 콜을 통해 운영체제가 대신해 줄 것을 요청하게 된다.

그러면 CPU의 제어권은 다시 운영체제로 넘어가게 된다. 인터럽트 발생 시 모드비트는 자동으로 0이 세팅되므로 운영체제는 모든 종류의 명령을 수행할 수 있게 된다.

> 이와 같이 시스템의 보안과 관련된 명령을 **특권명령**이라 지칭하며, 특권명령은 모드비트가 0일 때만 수행할 수 있다.

사용자 프로그램이 디스크에 저장된 파일에 자유롭게 접근할 수 있다면 보안상 문제가 발생할 수 있다. 자신의 소유가 아닌 다른 사람의 파일에 접근할 수 있기 때문이다. 따라서 모든 입출력 명령은 특권명령으로 규정해서 사용자 프로그램이 직접 입출력하는 것을 차단한다.
