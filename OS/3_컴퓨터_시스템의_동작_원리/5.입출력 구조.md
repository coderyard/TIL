# 🚏 입출력 구조

입출력(I/O)이란 컴퓨터 시스템이 컴퓨터 외부의 입출력 장치들과 데이터를 주고 받는 것을 말한다.

입출력 방식에는 두 가지가 존재한다. 첫 번째는 동기식 입출력, 두번 째는 비동기식 입출력이다.

---

## 동기식 입출력 (Synchronous I/O)

> 동기식 입출력이란 어떤 프로그램이 입출력을 요청했을 때 입출력 작업이 완료된 후에야 그 프로그램이 후속 작업을 수행할 수 있는 방식이다.

예를 들어보자.

1. 프로그램이 디스크에서 정보를 읽어와달라고 요청한다.

2. 디스크의 입출력이 완료되기까지는 어느 정도의 시간이 소요된다. 이 때 동기식 입출력은 입출력 작업이 진행되는 동안 해당 프로그램의 다음 명령을 수행하지 않고 기다린다.
3. 입출력 작업이 완료되어 인터럽트를 통해 그 사실이 전달된 후에야 CPU의 제어권이 그 프로그램에게 넘어가서 다음 명령을 수행할 수 있게 된다.

위의 동기식 입출력의 경우 CPU는 입출력 연산이 끝날 때까지 인터럽트를 기다리며 자원을 낭비하게 된다.

> CPU의 명령 속도에 비하면 입출력 연산 속도는 느리다. 그럼에도 불구하고 입출력이 완료될 때까지 대기했다가 CPU의 제어권을 넘기는 방식은 CPU가 입출력 완료까지 아무 일도 하지 못하므로 자원의 낭비를 초래하게 된다.

해당 방식으로 보면 매우 비효율적인 방식으로 보인다. 하지만 그에 대한 대안이 존재한다.

대안은 다음과 같다.

> 일반적으로 프로그램이 입출력 작업을 수행 중인 경우 CPU를 다른 프로그램에게 이양해 CPU가 계속 쉬지 않고 일할 수 있도록 한다.

이는 입출력 작업이 완료될 때까지 그 프로그램에 CPU를 다시 할당하더라도 명령을 수행하지 못하기 때문인데, 이를 관리하기 위해 운영체제는 프로그램을 몇 가지 상태로 나누고 입출력중인 프로그램의 경우 **봉쇄상태(Blocked state)** 로 전환시킨다.

봉쇄상태의 프로그램에게는 CPU를 할당하지 않고, CPU 할당 시 곧바로 명령을 수행할 수 있는 프로그램에게만 CPU를 할당한다.

> 이와 같은 이유로 다수의 입출력 연산이 동시에 요청되거나 처리될 수 있다.

하지만 다수의 프로그램의 입출력 연산이 진행되면서 같은 곳에 접근할 수 있으므로 입출력 요청의 동기화를 위해 장치별로 큐를 두어 요청한 순서대로 처리할 수 있도록 한다.

> 정리하자면 CPU의 효율적인 사용을 위해 입출력 연산이 수행되는 동안 다른 프로그램에게 CPU를 양도하면 동시에 다수의 입출력 연산이 일어날 수 있다.

이와 같이 다수의 프로그램이 동시에 입출력 연산을 요청하는 경우 **동기성(Synchronization)** 을 보장하기 위해 장치마다 큐를 두어 요청한 순서대로 처리할 수 있도록 한다.

장치마다 큐헤더가 존재하고 각 장치별로 입출력 수행 순서를 지켜주기 위한 큐를 관리하고 있다. 컨트롤러는 이 순서에 따라 매 시점 하나씩 자신에게 주어진 입출력 작업을 처리하게 된다.

요청된 입출력 연산이 완료되면 CPU에게 입출력 작업이 완료됐다는 인터럽트를 보내게 되고, 이 경우 커널은 인터럽트 처리 루틴으로 이동해 입출력 연산을 끝낸 프로그램이 CPU를 할당받을 수 있도록 그 프로그램의 상태를 봉쇄 상태로부터 해제시키게 된다.

---

## 비동기식 입출력 (Asynchronous I/O)

> 비동기식 입출력이란 입출력 연산을 요청한 후에 연산이 끝나기를 기다리는 것이 아니라 CPU의 제어권을 입출력 연산을 호출한 그 프로그램에게 다시 부여하는 방식이다.

어떤 프로그램이 데이터를 디스크에서 읽어오라는 요청을 했을 때 보통은 읽어온 결과를 이용해서 다음 연산을 수행하지만 경우에 따라서는 그 데이터와 관련 없이 수행할 수 있는 일이 있을 수 있다.

비동기식 입출력에서는 그러한 작업을 먼저 수행하고, 읽어오는 데이터가 반드시 수행할 수 있는 일들은 입출력 작업이 완료된 후에 수행하게 된다.

또한 입출력 요청이 디스크에서 읽어오는 요청이 아니라 디스크에 쓰는 요청이라면 쓰기 작업이 완료되기 전에도 다음 명령을 수행할 수 있으므로 비동기식 입출력이 사용될 수 있다.

---

## 결론

- ### 동기식 입출력

  사용자가 입출력 요청을 했을 때 먼저 커널로 CPU의 제어권이 넘어와서 입출력 처리와 관련된 커널의 코드가 수행된다.

  이때 입출력을 호출한 프로세스의 상태를 **봉쇄상태** 로 바꿔 입출력이 완료될 때까지 CPU를 할당받지 못하게 한다.

  입출력 작업 완료 시 인터럽트를 발생시켜 CPU에게 알리고 해당 프로세스의 봉쇄상태를 해제시켜 CPU를 할당받을 수 있는 권한이 다시 생기게 된다.

- ### 비동기식 입출력

  CPU의 제어권이 입출력 작업을 요청한 프로세스에게 곧바로 다시 주어지며, 입출력 연산이 완료되는 것과 무관하게 처리 가능한 작업부터 처리한다.

  한편 비동기식 입출력도 입출력 연산이 완료되면 동기식과 마찬가지로 인터럽트를 통해 CPU에 알린다. 그러면 그 시점부터 읽어온 데이터를 필요로 하는 멸령을 수행할 수 있게 된다.

> 일반적으로는 운영체제에게 입출력 요청을 할 경우 해당 프로그램의 입출력 작업이 완료될 때까지 그 프로그램을 봉쇄시키는 동기식 입출력을 사용한다. 이때 운영체제는 입출력 작업을 기다리는 프로세스를 줄세워 관리함으로써 **동기성**을 보장하게 된다.
